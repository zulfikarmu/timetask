<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pengatur Waktu Pomodoro BS5</title>
    <!-- Load Bootstrap 5 CDN for CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" xintegrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <style>
        /* Custom styling for sleek appearance and font */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0d1a26; /* Deep dark blue */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 1rem;
        }

        .timer-container {
            background-color: #1a344a; /* Card background color */
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            max-width: 450px;
            width: 100%;
            border-radius: 1rem; /* Rounded corners */
            padding: 2rem;
            color: #f8f9fa; /* Light text color */
        }

        .time-display {
            font-size: 5rem; /* Large font size for time */
            font-weight: 800;
            letter-spacing: 2px;
            text-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        }

        .mode-button {
            transition: all 0.2s ease;
            cursor: pointer;
            border-radius: 50px !important; /* Full pill shape */
            border: none;
            background-color: #2c4a62; /* Darker button base */
            color: #f8f9fa;
        }

        .mode-active {
            background-color: #ff6e40 !important; /* Vibrant orange for active mode */
            color: white !important;
            font-weight: 600;
            box-shadow: 0 4px 15px rgba(255, 110, 64, 0.4);
        }

        /* Responsive adjustments */
        @media (max-width: 640px) {
            .time-display {
                font-size: 3.5rem;
            }
        }
    </style>
</head>
<body>

    <div id="timerContainer" class="timer-container text-center">

        <!-- Mode Selection Buttons (Pills) -->
        <div class="d-flex justify-content-center bg-dark-subtle rounded-pill p-2 mb-4">
            <button id="pomodoroBtn" data-mode="pomodoro" class="mode-button px-4 py-2 me-2 mode-active">
                Pomodoro
            </button>
            <button id="shortBreakBtn" data-mode="shortBreak" class="mode-button px-4 py-2 me-2">
                Istirahat Pendek
            </button>
            <button id="longBreakBtn" data-mode="longBreak" class="mode-button px-4 py-2">
                Istirahat Panjang
            </button>
        </div>

        <!-- Timer Display -->
        <div id="timeDisplay" class="time-display my-4">25:00</div>
        <div class="text-secondary mb-4">Sisa Waktu</div>

        <!-- Control Buttons -->
        <div class="d-flex justify-content-center gap-3">
            <button id="startPauseBtn" class="btn btn-success btn-lg fw-bold py-2 px-5 rounded-3 shadow-sm" style="box-shadow: 0 0.5rem 1rem rgba(40, 167, 69, 0.3) !important;">
                Mulai
            </button>
            <button id="resetBtn" class="btn btn-secondary btn-lg fw-bold py-2 px-5 rounded-3 shadow-sm">
                Atur Ulang
            </button>
        </div>

        <!-- Status Message Box -->
        <div id="statusMessage" class="mt-4 text-warning-emphasis h-6">
            Siap untuk fokus!
        </div>

    </div>

    <!-- Load Bootstrap 5 CDN for JS (optional, mainly for components not used here) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" xintegrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    
    <script>
        // --- Timer Configuration and State ---
        const TIME_MODES = {
            pomodoro: 25 * 60,   // 25 minutes in seconds
            shortBreak: 5 * 60,  // 5 minutes in seconds
            longBreak: 15 * 60   // 15 minutes in seconds
        };

        let currentMode = 'pomodoro';
        let timeRemaining = TIME_MODES[currentMode];
        let timerInterval = null;
        let isPaused = true;
        let pomodoroCount = 0; // To track when to offer Long Break

        // --- DOM Elements ---
        const timeDisplay = document.getElementById('timeDisplay');
        const startPauseBtn = document.getElementById('startPauseBtn');
        const resetBtn = document.getElementById('resetBtn');
        const statusMessage = document.getElementById('statusMessage');
        const modeButtons = document.querySelectorAll('.mode-button');
        const container = document.getElementById('timerContainer');

        // --- Sound Setup (using native Audio) ---
        // Generates a simple tone sound (a very short sine wave) using the native AudioContext.
        // For simplicity and compatibility, we will use a basic audio object with a silent MP3 or a short beep.
        // Since we cannot rely on a hosted sound file, we will simulate a beep using the Web Audio API if possible,
        // but for maximum simplicity in a single file without external libraries, we'll use an audible HTML Audio approach.

        /**
         * Plays a simple notification sound using the Web Audio API (more reliable than Audio() object).
         */
        async function playSound() {
            try {
                // Check for Web Audio API support
                const AudioContext = window.AudioContext || window.webkitAudioContext;
                if (!AudioContext) {
                    console.log("Web Audio API not supported. Cannot play sound.");
                    return;
                }

                const audioCtx = new AudioContext();
                
                // Create oscillator for the beep
                const oscillator = audioCtx.createOscillator();
                oscillator.type = 'sine';
                oscillator.frequency.setValueAtTime(440, audioCtx.currentTime); // A4 note

                // Create gain node for volume control (fade out)
                const gainNode = audioCtx.createGain();
                gainNode.gain.setValueAtTime(1, audioCtx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.5); // Fade out over 0.5s

                // Connect nodes
                oscillator.connect(gainNode);
                gainNode.connect(audioCtx.destination);

                // Start and stop the tone
                oscillator.start();
                oscillator.stop(audioCtx.currentTime + 0.5);

            } catch (e) {
                console.error("Error playing sound with Web Audio API:", e);
            }
        }


        /**
         * Formats the total seconds into MM:SS string.
         * @param {number} totalSeconds - The time in seconds.
         * @returns {string} - The formatted time string.
         */
        function formatTime(totalSeconds) {
            const minutes = Math.floor(totalSeconds / 60).toString().padStart(2, '0');
            const seconds = (totalSeconds % 60).toString().padStart(2, '0');
            return `${minutes}:${seconds}`;
        }

        /**
         * Updates the time display and document title.
         */
        function updateDisplay() {
            timeDisplay.textContent = formatTime(timeRemaining);
            document.title = `${formatTime(timeRemaining)} - ${currentMode === 'pomodoro' ? 'Fokus' : 'Istirahat'}`;
            
            // Update container color slightly based on mode (using JS for dynamic color change)
            if (currentMode === 'pomodoro') {
                container.style.backgroundColor = '#1a344a'; // Focus blue
            } else {
                container.style.backgroundColor = '#384d5e'; // Break gray-blue
            }
        }

        /**
         * Starts or pauses the timer.
         */
        function startPauseTimer() {
            if (isPaused) {
                isPaused = false;
                startPauseBtn.textContent = 'Jeda';
                startPauseBtn.classList.remove('btn-success');
                startPauseBtn.classList.add('btn-warning');
                statusMessage.textContent = currentMode === 'pomodoro' ? 'Waktu Fokus Dimulai!' : 'Nikmati Istirahat Anda.';
                timerInterval = setInterval(tick, 1000);
            } else {
                isPaused = true;
                startPauseBtn.textContent = 'Lanjutkan';
                startPauseBtn.classList.remove('btn-warning');
                startPauseBtn.classList.add('btn-success');
                statusMessage.textContent = 'Dijeda. Ambil napas sebentar.';
                clearInterval(timerInterval);
            }
        }

        /**
         * The core timer loop that runs every second.
         */
        function tick() {
            if (timeRemaining > 0) {
                timeRemaining--;
                updateDisplay();
            } else {
                // Timer finished!
                clearInterval(timerInterval);
                playSound();
                statusMessage.textContent = 'Waktu Habis! Pindah ke mode selanjutnya.';
                isPaused = true;
                startPauseBtn.textContent = 'Mulai';
                startPauseBtn.classList.remove('btn-warning');
                startPauseBtn.classList.add('btn-success');


                handleTimerEnd();
            }
        }

        /**
         * Handles the transition to the next mode after the current one ends.
         */
        function handleTimerEnd() {
            if (currentMode === 'pomodoro') {
                pomodoroCount++;
                if (pomodoroCount >= 4) {
                    // After 4 pomodoros, switch to Long Break
                    switchMode('longBreak');
                    pomodoroCount = 0; // Reset counter
                } else {
                    // Otherwise, switch to Short Break
                    switchMode('shortBreak');
                }
            } else {
                // After any break, switch back to Pomodoro
                switchMode('pomodoro');
            }
        }

        /**
         * Resets the timer to the current mode's initial time.
         */
        function resetTimer() {
            clearInterval(timerInterval);
            isPaused = true;
            timeRemaining = TIME_MODES[currentMode];
            startPauseBtn.textContent = 'Mulai';
            startPauseBtn.classList.remove('btn-warning');
            startPauseBtn.classList.add('btn-success');
            statusMessage.textContent = 'Timer telah direset.';
            updateDisplay();
        }

        /**
         * Switches the timer mode.
         * @param {string} mode - The new mode ('pomodoro', 'shortBreak', 'longBreak').
         */
        function switchMode(mode) {
            currentMode = mode;
            timeRemaining = TIME_MODES[mode];
            
            // Reset timer state
            clearInterval(timerInterval);
            isPaused = true;
            startPauseBtn.textContent = 'Mulai';
            startPauseBtn.classList.remove('btn-warning');
            startPauseBtn.classList.add('btn-success');
            statusMessage.textContent = 'Siap untuk sesi baru.';

            // Update UI
            updateDisplay();
            updateModeButtons(mode);
        }

        /**
         * Updates the visual state of the mode selection buttons.
         * @param {string} activeMode - The currently active mode.
         */
        function updateModeButtons(activeMode) {
            modeButtons.forEach(button => {
                button.classList.remove('mode-active');
                if (button.dataset.mode === activeMode) {
                    button.classList.add('mode-active');
                }
            });
        }

        // --- Event Listeners ---
        startPauseBtn.addEventListener('click', startPauseTimer);
        resetBtn.addEventListener('click', resetTimer);

        modeButtons.forEach(button => {
            button.addEventListener('click', (e) => {
                // Find the mode from the button's data attribute, even if clicking a child element
                const modeToSwitch = e.currentTarget.dataset.mode; 
                // Only switch if the timer is paused or stopped
                if (isPaused) {
                    switchMode(modeToSwitch);
                } else {
                    statusMessage.textContent = "Jeda timer sebelum mengganti mode!";
                }
            });
        });
        
        // --- Initialization ---
        document.addEventListener('DOMContentLoaded', () => {
            // Initialize display on load
            updateDisplay(); 
            // Add initial active class to Pomodoro button
            updateModeButtons('pomodoro');
        });

    </script>

</body>
</html>
